<div class="popover-preview-container" >
    <div class="sc-d-flex">
        <button (click)="isPopoverPreviewVisible = !isPopoverPreviewVisible" class="popover-preview-btn" [ngStyle]="{'background': btnBackground}">
            <div>
                <span *ngIf="username">{{username}}</span>
                <span *ngIf="!username">#{{userId}}</span>
            </div>
            <div *ngIf="battlePassInfo$ | async as battlePassInfo">
                <div class="btn-battlepass-lvl">
                    <!--{{battlePass.battle_pass_priority}}-->
                    <div *ngFor="let lvl of battlePassInfo.levels">
                        <div *ngIf="lvl.activated_at !== null && !lvl.level_completed">
                            {{lvl.level_priority}}
                        </div>
                    </div>
                </div>
            </div>
        </button>
    </div>
        <div class="popover-preview" [hidden]="!isPopoverPreviewVisible"
             [ngStyle]="{
         'top':offsetTop > 0 && offsetTop + 'px',
         'right':offsetRight > 0 && offsetRight + 'px',
         'bottom':offsetBottom > 0 && offsetBottom + 'px',
         'left': offsetLeft > 0 && offsetLeft + 'px'}"
        >
            <scill-popover-preview-header [username]="username"
                                          [access-token]="accessToken"
                                          [app-id]="appId"
                                          [api-key]="apiKey"
                                          [user-id]="userId"
                                          [battle-pass-id]="battlePassId"
                                          [header-background]="headerBackground"
                                          [header-notch-absolute-right]="headerNotchAbsoluteRight"
                                          [header-text-color]="headerTextColor"
                                          [header-bp-lvl-color]="headerBpLvlColor"
                                          [header-progress-bar-background]="headerProgressBarBackground"
                                          [header-progress-bar-fill-background]="headerProgressBarFillBackground"
                                          [unlock-battle-pass-btn-background]="unlockBattlePassBtnBackground"
                                          [unlock-battle-pass-btn-text-color]="unlockBattlePassBtnTextColor"
            >
            </scill-popover-preview-header>

          <!-- Include any outside content -->
          <ng-content></ng-content>

            <div class="popover-preview-sections-container">
                <scill-popover-preview-bp-section  [app-id]="appId"
                                                   [api-key]="apiKey"
                                                   [user-id]="userId"
                                                   [battle-pass-id]="battlePassId"
                                                   [access-token]="accessToken"
                                                   [battle-pass-finished-type-bg-color]="battlePassFinishedTypeBgColor"
                                                   [battle-pass-in-progress-type-bg-color]="battlePassInProgressTypeBgColor"
                                                   [battle-pass-type-border-color]="battlePassTypeBorderColor"
                                                   [battle-pass-type-icon-color]="battlePassTypeIconColor"
                                                   [battle-pass-title-color]="battlePassTitleColor"
                                                   [battle-pass-lvl-progress-bar-background]="battlePassLvlProgressBarBackground"
                                                   [battle-pass-lvl-progress-bar-fill-background]="battlePassLvlProgressBarFillBackground"
                                                   [battle-pass-challenge-progress-background]="battlePassChallengeProgressBackground"
                                                   [battle-pass-challenge-progress-fill-background]="battlePassChallengeProgressFillBackground"
                                                   [battle-pass-challenge-background]="battlePassChallengeBackground"
                >
                </scill-popover-preview-bp-section>

              <ng-container *ngIf="personalChallengesInfo$ | async as personalChallengesInfo">
                <scill-popover-preview-section *ngFor="let category of personalChallengesInfo.categories; trackBy: categoryById"
                                               [title]="category.category_name"
                                               [category]="category"
                                               [app-id]="appId"
                                               [personal-challenges-category-title-color]="personalChallengesCategoryTitleColor"
                                               [personal-challenges-category-progress-bar-background]="personalChallengesCategoryProgressBarBackground"
                                               [personal-challenges-category-progress-bar-fill-background]="personalChallengesCategoryProgressBarFillBackground"
                                               [personal-challenges-background]="personalChallengesBackground"
                                               [personal-challenges-progress-background]="personalChallengesProgressBackground"
                                               [personal-challenges-progress-fill-background]="personalChallengesProgressFillBackground"
                                               [personal-challenges-in-progress-type-bg-color]="personalChallengesInProgressTypeBgColor"
                                               [personal-challenges-finished-type-bg-color]="personalChallengesFinishedTypeBgColor"
                                               [personal-challenges-type-border-color]="personalChallengesTypeBorderColor"
                                               [personal-challenges-type-icon-color]="personalChallengesTypeIconColor"
                                               [button-background]="buttonBackground"
                                               [button-text-color]=buttonTextColor
                >
                </scill-popover-preview-section>
              </ng-container>
            </div>

        </div>
</div>
